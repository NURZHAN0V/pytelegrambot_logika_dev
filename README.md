# Руководство для студентов по разработке телеграм бота 14+

---

### День 1: Первый бот за 2 часа — от нуля до команд

**Цель:** Запустить работающего бота, научиться обрабатывать команды и текст.

**Теория (25 мин):**
- Что такое API и бот
- Как получить токен через @BotFather (демонстрация)
- Установка Python‑пакетов: `pip install pyTelegramBotAPI python-dotenv`
- Структура программы: импорты → инициализация → обработчики → запуск

**Практика (95 мин):**
1. **Настройка проекта:**
   - Создать папку `my_bot`, файлы `main.py` и `.env`
   - Добавить `BOT_TOKEN=ваш_токен` в `.env`
   - Загрузить токен в код через `load_dotenv()`
2. **Простейший бот:**
   - Импортировать `telebot`, создать объект `bot = telebot.TeleBot(...)`
   - Написать обработчик `/start`: приветствие + имя пользователя (`message.from_user.first_name`)
   - Добавить `/help` с описанием команд
3. **Обработка текста:**
   - Реализовать эхо-режим: любой текст → бот повторяет
   - Добавить фильтр: если текст содержит «привет» → ответить «И тебе привет!»
4. **Запуск и тестирование:**
   - Запустить `python main.py`
   - Проверить работу в Telegram

**Домашнее задание (обязательное):**  
Добавить команду `/caps <текст>` → возвращает текст заглавными буквами.  
Подсказка: использовать `.upper()` и `message.text.split(maxsplit=1)`.

---

### **День 2: Кнопки, медиа и сохранение данных**

**Цель:** Сделать бота интерактивным и «памятливым».

**Теория (20 мин):**
- Типы клавиатур: обычные (`ReplyKeyboardMarkup`) и inline (`InlineKeyboardMarkup`)
- Как Telegram передаёт фото/голос/файлы (file_id, file_path)
- Хранение данных: словарь в памяти vs JSON-файл

**Практика (100 мин):**
1. **Кнопки:**
   - Создать меню с кнопками: «О нас», «Отправить фото», «Мои заметки»
   - При нажатии на «О нас» → отправлять описание
2. **Работа с медиа:**
   - Обработчик фото: при получении → отправлять подпись «Спасибо за фото!»
   - Сохранять `file_id` последнего фото в переменной
3. **Хранение данных:**
   - Создать словарь `notes = {}` (ключ — `chat.id`)
   - Команда `/note <текст>` → добавляет заметку
   - Команда `/notes` → выводит все заметки пользователя
4. **Сохранение в файл:**
   - При завершении работы (или по команде `/save`) — записывать `notes` в `notes.json`
   - При старте — загружать из файла (если есть)

**Домашнее задание:**  
Сделать бота-опросник: три вопроса подряд («Как тебя зовут?», «Сколько лет?», «Любимый предмет?») → сохраняет ответы в профиль пользователя.

---

### **День 3: Асинхронность и переход на `aiogram`**

**Цель:** Переписать бота на современный асинхронный фреймворк, понять преимущества.

**Теория (25 мин):**
- Почему `telebot` не масштабируется (блокирующие вызовы)
- Что такое `async`/`await` — простая аналогия: «заказ пиццы, пока ждёшь — делаешь домашку»
- Установка: `pip install aiogram`
- Архитектура: `Bot`, `Dispatcher`, `Router`, `Message`

**Практика (95 мин):**
1. **Перенос базового бота:**
   - Создать `main.py` с `async def main()`
   - Настроить роутер с `/start` и `/help`
   - Запустить через `dp.run_polling(bot)`
2. **Inline-кнопки:**
   - При `/menu` → отправлять сообщение с кнопкой «Узнать факт»
   - При нажатии → редактировать сообщение на случайный факт (список из 3 штук)
3. **Асинхронная задержка:**
   - Команда `/timer 3` → через 3 секунды отправляет «Время вышло!» (использовать `await asyncio.sleep()`)
4. **Сравнение кода:**
   - Параллельно показать один и тот же функционал на `telebot` и `aiogram`

**Домашнее задание:**  
Перенести систему заметок (из Дня 2) в `aiogram`-версию. Использовать `FSM` (Finite State Machine) для команды `/addnote`.

---

### **День 4: ИИ через OpenRouter — бот с «мозгами»**

**Цель:** Подключить языковую модель, научить бота отвечать осмысленно.

**Теория (20 мин):**
- Что такое OpenRouter, выбор модели (например, `meta-llama/llama-3.1-8b-instruct`)
- Получение API-ключа, безопасность
- Формат запроса: `messages = [{"role": "user", "content": "..."}]`
- Асинхронный HTTP: `aiohttp.ClientSession`

**Практика (100 мин):**
1. **Подготовка:**
   - Добавить `OPENROUTER_API_KEY` в `.env`
   - Написать функцию `async def ask_ai(prompt: str) -> str`
2. **Бот-ассистент:**
   - Любой текст → отправляется в ИИ → ответ возвращается пользователю
   - Добавить системный промт: «Ты — помощник для школьников. Отвечай кратко, без жаргона.»
3. **Контекст диалога:**
   - Хранить последние 3 пары сообщений в `dialog_history[chat_id]`
   - Передавать весь контекст в ИИ
4. **Обработка ошибок:**
   - Если статус ≠ 200 → отправлять «Не удалось получить ответ. Попробуй позже.»
   - Ограничить длину запроса (макс. 500 символов)

**Домашнее задание:**  
Добавить команду `/clear` — очищает историю диалога. Сделать, чтобы ИИ «забывал» всё после этого.

---

### **День 5: Мультимедиа — рисование, голос и файлы**

**Цель:** Научить бота работать с изображениями, распознавать речь и отправлять документы.

**Теория (15 мин):**
- Генерация изображений через OpenRouter (модели типа `stability-ai/sd-3-medium`)
- Обработка голоса: `.ogg` → распознавание через Whisper (через OpenRouter)
- Работа с файлами: `FSInputFile`, временные директории

**Практика (105 мин):**
1. **Генерация картинок:**
   - Команда `/draw закат` → отправляет промт в OpenRouter → получает URL → отправляет как фото
2. **Распознавание речи:**
   - При получении голосового:
     - Скачать файл: `file_info = await bot.get_file(message.voice.file_id)`
     - Сохранить во временный `.ogg` (использовать `tempfile`)
     - Отправить в OpenRouter с моделью `whisper-1` → получить текст → отправить пользователю
3. **Отправка документов:**
   - Команда `/report` → генерирует простой текстовый отчёт (например, список заметок) → сохраняет в `report.txt` → отправляет как документ
4. **Финальный микс:**
   - Бот принимает голос → распознаёт → отправляет в ИИ → ИИ отвечает → бот может нарисовать иллюстрацию по ответу

**Итоговый проект (30 мин):**  
Выбрать один из трёх вариантов и собрать за время урока:
- **Умный дневник:** голос → текст → сохранение + ИИ-анализ настроения  
- **Творческий ассистент:** рисует по описанию, генерирует подписи к фото  
- **Учебный бот:** задаёт вопросы, проверяет ответы, ведёт статистику

**Завершение:**  
Краткий разбор проектов, советы по деплою (бесплатные хостинги), рекомендации по дальнейшему обучению (курсы, документация).